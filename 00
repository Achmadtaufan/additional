select 
x1.ID, 
LTRIM(RTRIM(x1.CHDRNUM)) AS POLICY_NUMBER, 
LTRIM(RTRIM(CHDRCOY)) AS COMPANY_CODE,
LTRIM(RTRIM(x1.LIFE)) AS LIFE_NO,  
LTRIM(RTRIM(x1.COVERAGE)) AS COVERAGE_NO, 
LTRIM(RTRIM(x1.RIDER)) AS RIDER_NO, 
LTRIM(RTRIM(VALIDFLAG)) AS VALIDFLAG, 
CURRFROM CURRENT_FROM, 
TRANNO TRAN_NO, 
LTRIM(RTRIM(UALFND01)) AS FUND_CODE01, 
LTRIM(RTRIM(UALFND02)) AS FUND_CODE02, 
LTRIM(RTRIM(UALFND03)) AS FUND_CODE03, 
LTRIM(RTRIM(UALFND04)) AS FUND_CODE04, 
LTRIM(RTRIM(UALFND05)) AS FUND_CODE05, 
LTRIM(RTRIM(UALFND06)) AS FUND_CODE06, 
LTRIM(RTRIM(UALFND07)) AS FUND_CODE07, 
LTRIM(RTRIM(UALFND08)) AS FUND_CODE08, 
LTRIM(RTRIM(UALFND09)) AS FUND_CODE09, 
LTRIM(RTRIM(UALFND10)) AS FUND_CODE10, 
UALPRC01 FUND_ALLOC01, 
UALPRC02 FUND_ALLOC02, 
UALPRC03 FUND_ALLOC03, 
UALPRC04 FUND_ALLOC04, 
UALPRC05 FUND_ALLOC05, 
UALPRC06 FUND_ALLOC06, 
UALPRC07 FUND_ALLOC07, 
UALPRC08 FUND_ALLOC08, 
UALPRC09 FUND_ALLOC09, 
UALPRC10 FUND_ALLOC10, 
LTRIM(RTRIM(PRCAMTIND)) AS PRENCETAGE_INDICATOR, 
SEQNBR SEQNO,  
LTRIM(RTRIM(USRPRF)) AS USERPROFILE,   
LTRIM(RTRIM(AUD_TYPE)) AS AUD_TYPE,
AUD_TIME
 
from 
STG_ULNKPF X1 WITH(NOLOCK)
join (select CHDRNUM,LIFE,COVERAGE,RIDER ,max(id) id from STG_ULNKPF (nolock) group by CHDRNUM,LIFE,COVERAGE,RIDER )x2
	on x1.CHDRNUM = x2.CHDRNUM and x1.LIFE = x2.LIFE and x1.COVERAGE = x2.COVERAGE and x1.RIDER = x2.RIDER and x1.ID = x2.id
where  1=1 
and validflag <> '2' 
---and  X1.aud_type not in ('CB','DL')   
and AUD_Time is not null
