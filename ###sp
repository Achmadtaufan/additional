DECLARE @CurrentDate DATE = GETDATE()

-- Buat tabel sementara dengan struktur tetap
IF OBJECT_ID('TEMPDB..#TEMP_NEWRECRUIT') IS NOT NULL 
BEGIN
    DROP TABLE #TEMP_NEWRECRUIT  
END

CREATE TABLE #TEMP_NEWRECRUIT (
    AGENTID VARCHAR(50),
    AGENT_NAME VARCHAR(255),
    EFFECTIVEDATE DATE,
    PERIODE VARCHAR(6)
)

-- Masukkan data ke tabel sementara
IF DAY(@CurrentDate) = 1
BEGIN
    INSERT INTO #TEMP_NEWRECRUIT (AGENTID, AGENT_NAME, EFFECTIVEDATE, PERIODE)
    SELECT 
        A.AGENT_ID,
        A.AGENT_NAME,
        A.NEWRECRUIT_EFFECTIVEDATE,
        CONVERT(VARCHAR(6), A.NEWRECRUIT_EFFECTIVEDATE, 112)
    FROM DM_AGENTS A WITH (NOLOCK)
    WHERE CONVERT(VARCHAR(6), A.NEWRECRUIT_EFFECTIVEDATE, 112) = CONVERT(VARCHAR(6), DATEADD(MONTH, -1, @CurrentDate), 112)
END
ELSE
BEGIN
    INSERT INTO #TEMP_NEWRECRUIT (AGENTID, AGENT_NAME, EFFECTIVEDATE, PERIODE)
    SELECT 
        A.AGENT_ID,
        A.AGENT_NAME,
        A.NEWRECRUIT_EFFECTIVEDATE,
        CONVERT(VARCHAR(6), A.NEWRECRUIT_EFFECTIVEDATE, 112)
    FROM DM_AGENTS A WITH (NOLOCK)
    WHERE CONVERT(VARCHAR(6), A.NEWRECRUIT_EFFECTIVEDATE, 112) = CONVERT(VARCHAR(6), @CurrentDate, 112)
END
