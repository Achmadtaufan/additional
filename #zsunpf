
SELECT 
	CASE WHEN LEN(BATCACTMN)=1 THEN CONCAT(MAX(BATCACTYR),'0',MAX(BATCACTMN)) 
	ELSE CONCAT(BATCACTYR,BATCACTMN) END AS PERIODE, 
	LEFT(RLDGACCT,8) AS POLICYNUM,
	SUM(IIF(GLSIGN='-',ORIGAMT*-1,ORIGAMT)) AS SUM_ORIGAMT 
INTO 
	#ZSUNPF_ROP
FROM 
	STG..STG_ZSUNPF WITH(NOLOCK)
WHERE 
	CONCAT(SACSCODE,SACSTYP) IN ('LPSR') 
	AND LEFT(RLDGACCT,8) <> '' 
GROUP BY 
	CASE WHEN LEN(BATCACTMN)=1 THEN CONCAT(MAX(BATCACTYR),'0',MAX(BATCACTMN)) 
	ELSE CONCAT(BATCACTYR,BATCACTMN) END,
	LEFT(RLDGACCT,8)
HAVING 
	SUM(IIF(GLSIGN='-',ORIGAMT*-1,ORIGAMT)) <> 0
