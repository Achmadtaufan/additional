SELECT 
	POLICY_NUMBER,
	EFFECTIVE_DATE,
	CONCAT('20', SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),1,2), SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),3,2),SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),5,2)) AS 'TRANSACTION_DATE',
	MAX(DATESUB) AS DATESUB
FROM 
	LF_POLICYACTIVITY AC (NOLOCK) 		
WHERE 
	AC.BATCHCODE IN (SELECT TRANSCODE FROM RF_TRANSTYPEMAPPING WHERE ITEM='LA')
	AND LEFT(POLICY_NUMBER,1) <> 'D'
	AND RIGHT(TRANSACTION_DATE,2) = '26'
	AND POLICY_NUMBER = 'C0314311'
GROUP BY POLICY_NUMBER, [TRANSACTION_DATE], EFFECTIVE_DATE
HAVING DATEDIFF(YEAR,CONVERT(DATE,MAX(DATESUB),112),CONVERT(DATE,CONCAT('20', SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),1,2), SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),3,2),SUBSTRING(CAST(TRANSACTION_DATE AS VARCHAR),5,2)),112)) < 3

