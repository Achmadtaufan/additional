CREATE FUNCTION dbo.ToCamelCase (@input NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN
    DECLARE @output NVARCHAR(MAX) = '';
    DECLARE @i INT = 1;
    DECLARE @char NVARCHAR(1);
    DECLARE @tempWord NVARCHAR(MAX) = '';
    DECLARE @isWord BIT = 0;
    DECLARE @capitalize BIT = 1;
    DECLARE @specialWords TABLE (word NVARCHAR(MAX));
    
    -- Daftar kata-kata khusus yang tidak diubah ke camel case
    INSERT INTO @specialWords (word) VALUES ('FWD'), ('RE'), ('FW');
    
    WHILE @i <= LEN(@input)
    BEGIN
        SET @char = SUBSTRING(@input, @i, 1);
        
        IF @char LIKE '[A-Za-z0-9]'
        BEGIN
            SET @tempWord = @tempWord + @char;
            SET @isWord = 1;
        END
        ELSE
        BEGIN
            IF @isWord = 1
            BEGIN
                -- Cek jika @tempWord adalah kata khusus
                IF EXISTS (SELECT 1 FROM @specialWords WHERE word = UPPER(@tempWord))
                BEGIN
                    SET @output = @output + UPPER(@tempWord);
                END
                ELSE
                BEGIN
                    -- Cek jika @tempWord diawali angka dan diikuti huruf
                    IF @tempWord LIKE '[0-9]%[A-Z]'
                    BEGIN
                        DECLARE @numPart NVARCHAR(MAX);
                        DECLARE @textPart NVARCHAR(MAX);
                        
                        -- Memisahkan bagian angka dan huruf
                        SET @numPart = LEFT(@tempWord, PATINDEX('%[A-Z]%', @tempWord) - 1);
                        SET @textPart = SUBSTRING(@tempWord, PATINDEX('%[A-Z]%', @tempWord), LEN(@tempWord));
                        
                        -- Mengubah huruf-huruf setelah angka menjadi huruf kecil
                        SET @textPart = LOWER(@textPart);
                        
                        SET @output = @output + @numPart + @textPart;
                    END
                    ELSE
                    BEGIN
                        IF @capitalize = 1
                        BEGIN
                            SET @output = @output + UPPER(SUBSTRING(@tempWord, 1, 1)) + LOWER(SUBSTRING(@tempWord, 2, LEN(@tempWord) - 1));
                            SET @capitalize = 0;
                        END
                        ELSE
                        BEGIN
                            SET @output = @output + LOWER(@tempWord);
                        END
                    END
                END
                SET @tempWord = '';
            END
            SET @output = @output + @char;
            SET @isWord = 0;
            IF @char LIKE '[^A-Za-z0-9]'
            BEGIN
                SET @capitalize = 1;
            END
        END
        SET @i = @i + 1;
    END

    -- Memproses kata terakhir jika ada
    IF LEN(@tempWord) > 0
    BEGIN
        IF EXISTS (SELECT 1 FROM @specialWords WHERE word = UPPER(@tempWord))
        BEGIN
            SET @output = @output + UPPER(@tempWord);
        END
        ELSE
        BEGIN
            IF @tempWord LIKE '[0-9]%[A-Z]'
            BEGIN
                DECLARE @numPart NVARCHAR(MAX);
                DECLARE @textPart NVARCHAR(MAX);
                
                SET @numPart = LEFT(@tempWord, PATINDEX('%[A-Z]%', @tempWord) - 1);
                SET @textPart = SUBSTRING(@tempWord, PATINDEX('%[A-Z]%', @tempWord), LEN(@tempWord));
                
                SET @textPart = LOWER(@textPart);
                
                SET @output = @output + @numPart + @textPart;
            END
            ELSE
            BEGIN
                IF @capitalize = 1
                BEGIN
                    SET @output = @output + UPPER(SUBSTRING(@tempWord, 1, 1)) + LOWER(SUBSTRING(@tempWord, 2, LEN(@tempWord) - 1));
                END
                ELSE
                BEGIN
                    SET @output = @output + LOWER(@tempWord);
                END
            END
        END
    END

    RETURN @output;
END;
GO
