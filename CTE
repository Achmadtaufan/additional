SELECT policy_number,
       [1] AS Plan1,
       [2] AS Plan2,
       [3] AS Plan3,
       [4] AS Plan4,
       [5] AS Plan5
FROM 
(
    SELECT 
        policy_number,
        plan_code,
        ROW_NUMBER() OVER (PARTITION BY policy_number ORDER BY plan_code) AS rn
    FROM 
        tr_policyproduct
    WHERE 
        plan_type = 'rider' AND policy_number IN (SELECT policy_number FROM #eead)
) AS src
PIVOT 
(
    MAX(plan_code) 
    FOR rn IN ([1], [2], [3], [4], [5])
) AS pvt
ORDER BY policy_number;
